<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Reliable Transparency and Revocation Mechanisms</title>
<meta content="Brendan McMillion" name="author">
<meta content="
       This document describes reliable mechanisms for the publication and revocation
of Transport Layer Security (TLS) certificates.  This reliability takes several
forms. First, it provides browsers a strong guarantee that all certificates they
accept are truly published and unrevoked at the time they're accepted. Second,
it allows operators to monitor for mis-issuances related to their
websites in a highly efficient way without relying on third-party services.
Third, it provides a high degree of operational redundancy to minimize the risk
of cascading outages. 
    " name="description">
<meta content="xml2rfc 3.27.0" name="generator">
<meta content="next generation" name="keyword">
<meta content="unicorn" name="keyword">
<meta content="sparkling distributed ledger" name="keyword">
<meta content="draft-mcmillion-transparency-revocation-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.27.0
    Python 3.12.9
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.5
    lxml 5.3.0
    platformdirs 4.3.6
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-mcmillion-transparency-revocation.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Reliable Transparency and Revocation Mec</td>
<td class="right">February 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">McMillion</td>
<td class="center">Expires 28 August 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">TLS Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-mcmillion-transparency-revocation-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-02-24" class="published">24 February 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-08-28">28 August 2025</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B. McMillion</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Reliable Transparency and Revocation Mechanisms</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes reliable mechanisms for the publication and revocation
of Transport Layer Security (TLS) certificates.  This reliability takes several
forms. First, it provides browsers a strong guarantee that all certificates they
accept are truly published and unrevoked at the time they're accepted. Second,
it allows operators to monitor for mis-issuances related to their
websites in a highly efficient way without relying on third-party services.
Third, it provides a high degree of operational redundancy to minimize the risk
of cascading outages.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://Bren2010.github.io/draft-transparency-revocation/draft-mcmillion-transparency-revocation.html">https://Bren2010.github.io/draft-transparency-revocation/draft-mcmillion-transparency-revocation.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-mcmillion-transparency-revocation/">https://datatracker.ietf.org/doc/draft-mcmillion-transparency-revocation/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/Bren2010/draft-transparency-revocation">https://github.com/Bren2010/draft-transparency-revocation</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 28 August 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-architecture" class="internal xref">Architecture</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-requirements" class="internal xref">Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-discussion" class="internal xref">Discussion</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-summary" class="internal xref">Summary</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-transparency-log" class="internal xref">Transparency Log</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-structure" class="internal xref">Structure</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-subtree-inclusion-proofs" class="internal xref">Subtree Inclusion Proofs</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-tree-heads" class="internal xref">Tree Heads</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-endpoints" class="internal xref">Endpoints</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-get-tree" class="internal xref">Get Tree</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-add-chain" class="internal xref">Add Chain</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.3">
                    <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="auto internal xref">4.2.3</a>.  <a href="#name-refresh-proof" class="internal xref">Refresh Proof</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.4">
                    <p id="section-toc.1-1.4.2.2.2.4.1"><a href="#section-4.2.4" class="auto internal xref">4.2.4</a>.  <a href="#name-get-certificates" class="internal xref">Get Certificates</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.5">
                    <p id="section-toc.1-1.4.2.2.2.5.1"><a href="#section-4.2.5" class="auto internal xref">4.2.5</a>.  <a href="#name-add-revocation" class="internal xref">Add Revocation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.6">
                    <p id="section-toc.1-1.4.2.2.2.6.1"><a href="#section-4.2.6" class="auto internal xref">4.2.6</a>.  <a href="#name-get-revocations" class="internal xref">Get Revocations</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-tls-extension" class="internal xref">TLS Extension</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-clienthello" class="internal xref">ClientHello</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-serverhello" class="internal xref">ServerHello</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-certificate" class="internal xref">Certificate</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-extended-resolution-mechani" class="internal xref">Extended Resolution Mechanisms</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-background-requests" class="internal xref">Background Requests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-oblivious-third-party" class="internal xref">Oblivious Third Party</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-final-reporting" class="internal xref">Final Reporting</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-operational-considerations" class="internal xref">Operational Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-client-state" class="internal xref">Client State</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-server-behavior" class="internal xref">Server Behavior</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-handling-forks" class="internal xref">Handling Forks</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-certificate-authority" class="internal xref">Certificate Authority</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-poison-extension" class="internal xref">Poison Extension</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-performance-considerations" class="internal xref">Performance Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-transparency-log-2" class="internal xref">Transparency Log</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-tls-server" class="internal xref">TLS Server</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-clienthello-extension" class="internal xref">ClientHello Extension</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-downgrade-prevention" class="internal xref">Downgrade Prevention</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="auto internal xref">12.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Certificate Transparency (CT) ecosystem created by <span>[<a href="#RFC6962" class="cite xref">RFC6962</a>]</span> has been
immensely valuable to security on the internet. However, shortcomings in the
design have become apparent over time:<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The security that CT provides to verifiers is based on an assumption of
non-collusion between multiple parties. Historically, this assumption has been
challenging to maintain, as it degrades quickly without active management. The
compromise of a single Transparency Log or the unexpected acquisition of a
single business is often sufficient to allow the possibility of undetectable
mis-issued certificates. This is compounded by the fact that multiple parties in
the CT ecosystem play multiple roles (such as Certificate Authorities that are
also Transparency Log operators that are also browser vendors), which makes
reasoning about the possibility of collusion even more tricky.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">It is also becoming far too expensive to both operate a CT log, and to monitor
CT logs. Logs are required to serve their entire contents to anyone on the
internet, which consumes a significant amount of outbound bandwidth. Similarly,
monitoring certificate issuance in CT requires downloading the entire contents
of all logs, which is several terabytes of data at minimum.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">The fundamental purpose for publishing TLS certificates is to allow site operators
to identify and and revoke those certificates which are mis-issued. However,
revocation systems have historically been plagued by a requirement to "fail
open". That is, revocation checks would stop being enforced in certain (often,
easily engineered) scenarios. For example, if the server didn't proactively
offer proof of non-revocation or if a third-party service was inaccessible for
too long, this might cause revocation checks to be disabled. One promising
exception to this general principle, OCSP Must-Staple <span>[<a href="#RFC7633" class="cite xref">RFC7633</a>]</span>, has
unfortunately been the victim of waning support for OCSP by Certificate
Authorities.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This motivates a need for a new system of publishing certificates that's
resistant to collusion and dramatically more efficient to operate, and a need
for a new system of revoking certificates that can be reliably enforced.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="architecture">
<section id="section-3">
      <h2 id="name-architecture">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-architecture" class="section-name selfRef">Architecture</a>
      </h2>
<p id="section-3-1">The system has several roles, which we describe in more detail below. Parties
are allowed to assume multiple roles.<a href="#section-3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3-2">
        <dt id="section-3-2.1"><strong>Certificate Authority:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-3-2.2">
          <p id="section-3-2.2.1">A service that performs domain-control validation and authenticates
certificates and revocations.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.3"><strong>Transparency Log:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-3-2.4">
          <p id="section-3-2.4.1">A service that provides an append-only, publicly-auditable log of certificates
and revocations issued by a wide range of Certificate Authorities.<a href="#section-3-2.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.5"><strong>Site Operator:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-3-2.6">
          <p id="section-3-2.6.1">The individual or organization responsible for the operation and maintenance
of a website, as identified by a single domain name or IP address.<a href="#section-3-2.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-3-2.7"><strong>User Agent:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-3-2.8">
          <p id="section-3-2.8.1">A software application, typically but not necessarily a web browser, that acts
on behalf of a user to access and interact with websites.<a href="#section-3-2.8.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
<div id="requirements">
<section id="section-3.1">
        <h3 id="name-requirements">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-requirements" class="section-name selfRef">Requirements</a>
        </h3>
<p id="section-3.1-1">The following baseline requirements for the system are as follows:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.1-2">
<li id="section-3.1-2.1">
            <p id="section-3.1-2.1.1">For a certificate to be mis-issued and not eventually published: two trusted
parties must collude to misbehave and all verifiers that observed the
certificate must be stateless.<a href="#section-3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-2.2">
            <p id="section-3.1-2.2.1">For a verifier to accept a revoked certificate and this not be eventually
detected: one trusted party must misbehave and all verifiers that accepted
the certificate must be stateless.<a href="#section-3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-2.3">
            <p id="section-3.1-2.3.1">It must be reasonably efficient for Site Operators to audit all trusted
Certificate Authorities for mis-issuances affecting their domain names and IP
addresses.<a href="#section-3.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-2.4">
            <p id="section-3.1-2.4.1">The system must not have any single points of failure, other than those in
the web PKI as it exists today.<a href="#section-3.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-2.5">
            <p id="section-3.1-2.5.1">Clients must be able to connect to a server without having immediate
connectivity to third-party services.<a href="#section-3.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-2.6">
            <p id="section-3.1-2.6.1">The domain names and/or IP addresses of websites visited by a client must not
be leaked, other than how they are in the web PKI as it exists today.<a href="#section-3.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-2.7">
            <p id="section-3.1-2.7.1">The system must be reasonable for non-browser user agents to deploy.<a href="#section-3.1-2.7.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-3.1-2.8">
            <p id="section-3.1-2.8.1">The system must have a reasonable path to scale indefinitely.<a href="#section-3.1-2.8.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-3.1-3">These requirements and their main consequences are discussed in more detail in
the following subsection.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="discussion">
<section id="section-3.2">
        <h3 id="name-discussion">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-discussion" class="section-name selfRef">Discussion</a>
        </h3>
<p id="section-3.2-1"><strong>Transparency must support stateful verification.</strong> The fundamental goal of any
transparency system is to ensure that data shown to one participant is equally
visible to any other participant. Transparency systems that achieve this by
relying solely on stateless verification are more accurately referred to as a
"co-signing" schemes. This is because the security of these systems reduces
solely to successful verification of the co-signers' signatures on a claim that
some data is properly published, and ultimately to an assumption that the
co-signers are not colluding to suppress the data.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">In the web PKI, the co-signers in such a system would be a Certificate Authority
and one or more Transparency Logs. The diverse and rapidly changing nature of
the web makes collusion between participants easy to achieve and difficult to
detect. Without a technical mechanism to detect or prevent collusion, it can be
covertly achieved and maintained for very long periods of time.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">The typical solution to this problem is to construct the system such that a
larger number of co-signers need to collude to succeed in launching an attack.
However, requiring that a large number of signatures from different co-signers
be presented in every TLS handshake would easily bloat the handshake to an
unacceptable degree. This is especially true when the signatures are required to
come from quantum-secure signature schemes, given that they're much larger than
their classical alternatives.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2-4">While the system described in this document supports stateless verification,
which is secure as long as there's no collusion between trusted parties, it also
provides stateful verification. Stateful verification allows verifiers to detect
violations of the system's core security guarantees, that all certificates they
accept are published and unrevoked, regardless of any amount of collusion by
trusted parties. This obviates the need for having a large number of co-signers,
allowing TLS handshakes to remain small and providing the broader ecosystem
(including stateless verifiers) with a reliable early warning system for
misbehavior by trusted parties.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5"><strong>Servers must provide proof directly to clients that their certificate
satisfies transparency requirements and isn't revoked.</strong> If proof of
transparency and non-revocation isn't provided by the server, it must be fetched
from one or more third-party services. The primary issue with this is that it
ties the server's global availability to the global availability of these
third-party services, for which the server operator has no way to preempt or
resolve deficiencies. Proposals for transparency and revocation that rely on
connectivity to third-party services have historically been required to "fail
open", meaning that if the third-party service is inaccessible for too long,
then the client stops enforcing these security properties altogether. Failing
open is incompatible with requirements 1 and 2 because it introduces the
possibility that a client might accept an unpublished or revoked certificate
without explicit misbehavior by a trusted party.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">A second issue is that, since we're primarily interested in describing a system
that works equally well regardless of the client's software vendor (requirement
7), such a service would reasonably be prohibited from restricting access to
itself. It would receive regular requests from all internet-connected devices,
creating significant scaling and centralization concerns.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
<p id="section-3.2-7"><strong>Servers must refresh their certificates regularly and automatically.</strong> This is
a direct consequence of the decision that servers must be responsible for
providing clients proof that their certificates are not revoked. If a server is
not required to refresh its certificate, it can arbitrarily delay the client
from learning about changes in the certificate's revocation status. This would
be incompatible with requirement 2, since servers are not considered trusted
parties and should not be capable of undermining revocation on their own.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<p id="section-3.2-8"><strong>Revocation must be provided by the transparency system.</strong> A CA can initiate
revocation either by declining to sign new statements related to a certificate
(for example, by not renewing a short-lived certificate or not creating an OCSP
staple), or by signing a new "statement of revocation" for the certificate.<a href="#section-3.2-8" class="pilcrow">¶</a></p>
<p id="section-3.2-9">In the case where CAs initiate revocation by signing a new "statement of
revocation", proving that a certificate is not revoked consists of proving that
such a statement does not exist. Proving that a statement does not exist
requires exhaustive knowledge of all such statements. Any method of conveying
this exhaustive knowledge, if it is not a transparency system, admits the
possibility of split-view attacks which are not eventually detected. Split-view
attacks in this context would allow a CA to mis-issue a certificate, claim to
revoke it, and then maintain the certificate's utility by presenting different
views of its revocation status to attack victims than to other participants. The
possibility of such a split-view attack would violate requirement 2, as it would
not be after-the-fact detectable. More practically though, it would render
revocation fundamentally insufficient for correcting mis-issuance and would
create a need for a second (more effective) revocation mechanism.<a href="#section-3.2-9" class="pilcrow">¶</a></p>
<p id="section-3.2-10">In the case where CAs initiate revocation by declining to sign new statements,
this makes the CA a single point-of-failure for websites relying on it. A
prolonged CA outage would have the effect of revoking all certificates and
causing a cascading outage, violating requirement 4. Proposals for revocation
that fall into this category have historically mitigated this risk by providing
very slow revocation, bounded by the longest conceivable outage that a CA may
have (typically at least one week). However, it's clear that the same potential
for split-view attacks would still exist, as discussed above.<a href="#section-3.2-10" class="pilcrow">¶</a></p>
<p id="section-3.2-11">When specifically considering short-lived certificates as an approach to
revocation, effectiveness depends on whether or not <strong>all</strong> certificates in the
PKI are required to be short-lived. If clients enforce that all certificates are
short-lived, and issuance is transparent, then revocation is provided by the
transparency system as claimed. If certificates may be issued with longer
lifespans, then a second revocation mechanism for these certificates is
necessary.<a href="#section-3.2-11" class="pilcrow">¶</a></p>
<p id="section-3.2-12"><strong>Transparency Logs must implement the Key Transparency protocol.</strong> As stated at
the beginning of this section, the goal of any transparency system is to ensure
that data shown to one participant is equally visible to any other participant.
In the context of the web PKI, this means that a Site Operator that contacts all
trusted Transparency Logs should come away with an exhaustive knowledge of all
certificates that a client might be presented with when connecting to their
servers.<a href="#section-3.2-12" class="pilcrow">¶</a></p>
<p id="section-3.2-13">Most transparency systems require downloading the entirety of the log's contents
to ensure that all potentially relevant entries are found. This quickly becomes
prohibitively expensive for all parties, violating requirements 3 and 8.
Currently roughly 7.5 million certificates are issued per day, with an average
size of 3 kilobytes. This means that a site operator would need to download
almost 700 gigabytes of certificates to cover a single month of issuance.
Outbound bandwidth typically costs between 1 to 9 cents per gigabyte, which
means that providing this data to a single site operator would cost the
Transparency Log between $6 to $60. For any reasonable estimate of the number of
site operators on the internet, this represents an exceptional burden on a
Transparency Log.<a href="#section-3.2-13" class="pilcrow">¶</a></p>
<p id="section-3.2-14">In the existing Certificate Transparency ecosystem, because of this exceptional
cost, Site Operators have overwhelmingly elected not to do this work themselves
and have instead outsourced it to third-party monitors. Third-party monitors
represent a problematic break in the security guarantees of Certificate
Transparency, as there are no enforceable requirements on their behavior. They
are not audited for correct behavior like Certificate Authorities are, and there
are no technical mechanisms to prevent misbehavior like a Transparency Log would
have. This has had the real-world impact of undermining the system's
transparency guarantees <span>[<a href="#ct-in-wild" class="cite xref">ct-in-wild</a>]</span>.<a href="#section-3.2-14" class="pilcrow">¶</a></p>
<p id="section-3.2-15">Key Transparency <span>[<a href="#I-D.draft-ietf-keytrans-protocol" class="cite xref">I-D.draft-ietf-keytrans-protocol</a>]</span> augments a Transparency
Log with additional structure to allow efficient and verifiable searches for
specific data. This allows Site Operators to download only a small subset of the
entries of the Transparency Log, but still be guaranteed to have received all
certificates that are relevant to them. As a result of the significantly reduced
need for outbound bandwidth, operating such a Transparency Log would cost around
one million times less than it would otherwise.<a href="#section-3.2-15" class="pilcrow">¶</a></p>
</section>
</div>
<div id="summary">
<section id="section-3.3">
        <h3 id="name-summary">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-summary" class="section-name selfRef">Summary</a>
        </h3>
<p id="section-3.3-1">In summary, the system described in this document works as follows:<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-2.1">
            <p id="section-3.3-2.1.1">Site Operators obtain a certificate from a Certificate Authority and submit it
to one of many trusted Transparency Logs to obtain an inclusion proof.<a href="#section-3.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.3-2.2">
            <p id="section-3.3-2.2.1">User Agents that contact the Site Operator's server over TLS include compact
transparency-related state in their ClientHello. The server provides its
certificate and inclusion proof (potentially modified based on the client's
advertised state) in the Certificate message. The User Agent verifies that the
inclusion proof aligns with its state, is sufficiently recent, and
indicates the certificate is unrevoked.<a href="#section-3.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.3-2.3">
            <p id="section-3.3-2.3.1">As time goes on, the current inclusion proof will become stale. Site
Operators refresh their inclusion proof by requesting a new one from the
Transparency Log.<a href="#section-3.3-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3-2.3.2.1">
                <p id="section-3.3-2.3.2.1.1">If the first Transparency Log is offline, the Site Operator may failover to
any of several other trusted Transparency Logs.<a href="#section-3.3-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-3.3-2.4">
            <p id="section-3.3-2.4.1">At any time in the background, the Site Operator may query any of the trusted
Transparency Logs and verifiably learn about all new certificates that have
been issued affecting their domain names or IP addresses. Since the Key
Transparency protocol specifies a "correct" location for a certificate to be
stored, and since User Agents enforce this when verifying inclusion proofs,
requesting all certificates for a single identifier always remains highly
efficient.<a href="#section-3.3-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-3.3-3">The remainder of this document describes these steps in more detail.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="transparency-log">
<section id="section-4">
      <h2 id="name-transparency-log">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-transparency-log" class="section-name selfRef">Transparency Log</a>
      </h2>
<p id="section-4-1">Transparency Logs are online services that maintain a tree data structure and
provide access to it through the endpoints described below. Transparency Logs
are generally only contacted by Site Operators. Site Operators regularly issue
requests to the Transparency Log's endpoints to either obtain fresh inclusion
proofs for their certificates, or to monitor for mis-issuances affecting their
properties.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">While a Transparency Log may be operated by a Certificate Authority,
Transparency Logs <span class="bcp14">SHOULD</span> accept certificates issued by a broad set of the
current widely-trusted Certificate Authorities. This ensures that, if one
Transparency Log has an outage, there are several other Transparency Logs that
Site Operators can failover to and fetch fresh inclusion proofs from.<a href="#section-4-2" class="pilcrow">¶</a></p>
<div id="structure">
<section id="section-4.1">
        <h3 id="name-structure">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-structure" class="section-name selfRef">Structure</a>
        </h3>
<p id="section-4.1-1">The data structure maintained by a Transparency Log is identical to the Combined
Tree described in <span>[<a href="#I-D.draft-ietf-keytrans-protocol" class="cite xref">I-D.draft-ietf-keytrans-protocol</a>]</span>, with two exceptions:
the search keys that are used to navigate the Prefix Tree, and the
data committed to by each Prefix Tree leaf node, are different.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">The search key used to navigate the Prefix Tree is a function of the
certificate's <strong>reference identifier</strong> in the TLS handshake. The reference
identifier is the single domain name or IP address that the TLS client will
verify the certificate against. When the reference identifier is a domain name,
it is reduced to the registrable domain ("example.com" instead of
"sub.example.com"). The registrable domain or IP address is then hashed,
producing the value which is used to navigate the Prefix Tree. The hash function
used corresponds to the ciphersuite hash function. No VRF is used, or version
counter is included in the hash function input, as they would be in
<span>[<a href="#I-D.draft-ietf-keytrans-protocol" class="cite xref">I-D.draft-ietf-keytrans-protocol</a>]</span>.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">Rather than a privacy-preserving commitment, each Prefix Tree leaf contains the
hash of a <code>DomainCertificates</code> structure:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.1-4">
<pre>
struct {
  opaque root&lt;Hash.Nh&gt;;
  uint32 first_valid;
  uint32 invalid_entries&lt;0..2^8-1&gt;;
} DomainCertificates;
</pre><a href="#section-4.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1-5">The <code>root</code> field contains the root hash of a Log Tree, which will be referred to
as the <strong>Certificate Subtree</strong> to avoid confusion with the top-level Log Tree.
The Certificate Subtree contains all certificate chains that may be presented
for a particular registrable domain or IP address, in the order they were
logged. The leaves of the Certificate Subtree are represented as
<code>SubtreeLogLeaf</code> structures, used in place of <code>LogLeaf</code>:<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.1-6">
<pre>
opaque Certificate&lt;0..2^16-1&gt;;

struct {
  Certificate chain&lt;0..2^8-1&gt;;
} SubtreeLogLeaf;
</pre><a href="#section-4.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.1-7">The <code>first_valid</code> field contains the index of the first entry in the Certificate
Subtree where no certificate in the chain is revoked or expired. The
<code>invalid_entries</code> field contains the list of indices of all entries to the right
of <code>first_valid</code> where one or more of the certificates in the chain have been
revoked.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">Transparency Logs <span class="bcp14">SHOULD</span> determine whether a certificate chain is expired by
comparing the Not After field of each certificate in the chain to the timestamp
of the Log Tree's rightmost leaf. However, Transparency Logs do not have a
proactive responsibility to keep the <code>first_valid</code> field updated; it is simply
provided as a mechanism to drain <code>invalid_entries</code>.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1-9">When computing <code>PrefixLeaf</code>, the hash of the leaf certificate's reference
identifier is stored in the <code>vrf_output</code> field and the hash of
<code>DomainCertificates</code> is stored in the <code>commitment</code> field.<a href="#section-4.1-9" class="pilcrow">¶</a></p>
<div id="subtree-inclusion-proofs">
<section id="section-4.1.1">
          <h4 id="name-subtree-inclusion-proofs">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-subtree-inclusion-proofs" class="section-name selfRef">Subtree Inclusion Proofs</a>
          </h4>
<p id="section-4.1.1-1">It is often necessary in later parts of this document to provide proofs of
inclusion for entries in the Certificate Subtree. Such proofs are provided as
follows:<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.1.1-2">
<pre>
struct {
  uint32 position;
  uint32 size;
  InclusionProof inclusion;
  uint32 first_valid;
  uint32 invalid_entries&lt;0..2^8-1&gt;;
} SubtreeInclusionProof;
</pre><a href="#section-4.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1-3">The <code>position</code> field contains the index of the leaf for which inclusion is being
proven, while the <code>size</code> field contains the total number of leaves in the
Certificate Subtree. The proof in <code>inclusion</code> allows a recipient to recompute
the root hash of the Certificate Subtree, given the correct value for the leaf
at <code>position</code>.<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1.1-4">The <code>first_valid</code> and <code>invalid_entries</code> fields duplicate the contents of the
DomainCertificates structure. This allows recipients to verify that the leaf at
<code>position</code> is not revoked, and also allows them to recompute the hash of the
DomainCertificates structure stored at a given leaf of the Prefix Tree.<a href="#section-4.1.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1.1-5">Note that this document follows the pattern established in
<span>[<a href="#I-D.draft-ietf-keytrans-protocol" class="cite xref">I-D.draft-ietf-keytrans-protocol</a>]</span> of requiring each element of an
InclusionProof to be a balanced subtree. An InclusionProof may also function as
a "consistency proof" if the recipient is known to have observed a previous
version of the tree.<a href="#section-4.1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tree-heads">
<section id="section-4.1.2">
          <h4 id="name-tree-heads">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-tree-heads" class="section-name selfRef">Tree Heads</a>
          </h4>
<p id="section-4.1.2-1">Transparency Logs are generally expected to add only a small number of new
entries to their Log Tree per day. This keeps proof sizes small and also ensures
that, when User Agents advertise having observed a particular tree head, there
are a large number of potential hosts that could've conveyed the tree head. To
support providing inclusion proofs for new submissions quickly, Transparency
Logs issue <strong>provisional</strong> tree heads. A provisional head is, in essence, a
work-in-progress log entry that will be added to the rightmost edge of the Log
Tree within a bounded amount of time.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.1.2-2">
<pre>
struct {
  uint64 tree_size;
  uint32 counter;
  opaque signature&lt;0..2^16-1&gt;;
} ProvisionalTreeHead;
</pre><a href="#section-4.1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2-3">The <code>tree_size</code> field is equal to the <code>tree_size</code> field of the last
(non-provisional) TreeHead that was published.  The <code>counter</code> field
starts at zero and is incremented by 1 for each subsequent ProvisionalTreeHead
that's published without the creation of a new TreeHead.<a href="#section-4.1.2-3" class="pilcrow">¶</a></p>
<p id="section-4.1.2-4">The <code>signature</code> field of both TreeHead and ProvisionalTreeHead structures is
computed over a serialized TreeHeadTBS structure:<a href="#section-4.1.2-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.1.2-5">
<pre>
struct {
  CipherSuite ciphersuite;
  opaque signature_public_key&lt;0..2^16-1&gt;;

  uint64 max_ahead;
  unit64 max_behind;
  optional&lt;uint64&gt; maximum_lifetime;
} Configuration;

enum {
  reserved(0),
  standard(1),
  provisional(2),
  (255)
} TreeHeadType;

struct {
  Configuration config;

  TreeHeadType tree_head_type;
  select (TreeHeadTBS.tree_head_type) {
    case standard:
      uint64 tree_size;
    case provisional:
      uint64 tree_size;
      uint32 counter;
      opaque prefix_root&lt;Hash.Nh&gt;;
  }
  opaque root&lt;Hash.Nh&gt;;
} TreeHeadTBS;
</pre><a href="#section-4.1.2-5" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2-6">The <code>max_ahead</code> and <code>max_behind</code> fields contain the maximum amount of time in
milliseconds that a tree head may be ahead of or behind the user's local clock
without being rejected. If the Transparency Log has chosen to define a maximum
lifetime for log entries, per Section 5.2 of
<span>[<a href="#I-D.draft-ietf-keytrans-protocol" class="cite xref">I-D.draft-ietf-keytrans-protocol</a>]</span>, this duration in milliseconds is stored
in the <code>maximum_lifetime</code> field.<a href="#section-4.1.2-6" class="pilcrow">¶</a></p>
<p id="section-4.1.2-7">When the TreeHeadTBS structure is for a <code>provisional</code> tree head type,
<code>prefix_root</code> contains the work-in-progress root hash of the Prefix Tree. This
value may change further before it is added as a new rightmost log entry.
However, stateful clients will enforce that none of the certificates they
observe are removed or un-revoked.<a href="#section-4.1.2-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="endpoints">
<section id="section-4.2">
        <h3 id="name-endpoints">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-endpoints" class="section-name selfRef">Endpoints</a>
        </h3>
<p id="section-4.2-1">Transparency Logs expose the following endpoints over HTTP or HTTPS. Which
endpoint is being accessed is determined by the request's method and path.
Request and response bodies are specific structures, which are encoded according
to TLS format and then base64 encoded.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div id="get-tree">
<section id="section-4.2.1">
          <h4 id="name-get-tree">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-get-tree" class="section-name selfRef">Get Tree</a>
          </h4>
<p id="section-4.2.1-1">This endpoint is accessed by Site Operators to initialize or update their view
of the tree for the purpose of providing inclusion proofs to clients.<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.2.1-2">GET /get-tree{?tree_size=X}<a href="#section-4.2.1-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.2.1-3">
<pre>
struct {
  TreeHead tree_head;
  CombinedTreeProof combined;
} GetTreeResponse;
</pre><a href="#section-4.2.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.2.1-4">The request optionally contains a <code>tree_size</code> query parameter, containing the
size of the most recent tree head that has been observed by the client. If
present, <code>tree_size</code> <span class="bcp14">MUST</span> be the size of a tree head that was published less
than or equal to <code>max_behind</code> milliseconds in the past.<a href="#section-4.2.1-4" class="pilcrow">¶</a></p>
<p id="section-4.2.1-5">If the <code>tree_size</code> query parameter was provided but a more recent tree head
than <code>tree_size</code> has not been issued, the Transparency Log <span class="bcp14">MAY</span> respond with a
204 No Content status code and an empty response body. Otherwise, the response
body is GetTreeResponse. The <code>tree_head</code> field contains the most recent tree
head published by the Transparency Log. The <code>combined</code> field contains the
following:<a href="#section-4.2.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-6.1">
              <p id="section-4.2.1-6.1.1">The output of updating the view of the tree from <code>tree_size</code> (if provided) to
<code>tree_head.tree_size</code> (Section 10.3.1 of
<span>[<a href="#I-D.draft-ietf-keytrans-protocol" class="cite xref">I-D.draft-ietf-keytrans-protocol</a>]</span>).<a href="#section-4.2.1-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-6.2">
              <p id="section-4.2.1-6.2.1">The timestamps of all log entries that are more recent than <code>tree_size</code> and
have timestamps less than or equal to <code>10*max_behind</code>. These timestamps are
provided in left-to-right order. However, note that some of them may be
omitted if they are duplicates with the previous bullet, as explained in
Section 10.3 of <span>[<a href="#I-D.draft-ietf-keytrans-protocol" class="cite xref">I-D.draft-ietf-keytrans-protocol</a>]</span>.<a href="#section-4.2.1-6.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.2.1-7">If <code>tree_size</code> is provided, the proof in <code>combined.inclusion</code> is additionally a
consistency proof.<a href="#section-4.2.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="add-chain">
<section id="section-4.2.2">
          <h4 id="name-add-chain">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-add-chain" class="section-name selfRef">Add Chain</a>
          </h4>
<p id="section-4.2.2-1">This endpoint is accessed by Site Operators to produce a proof of inclusion for
their certificate chain.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2.2-2">POST /add-chain<a href="#section-4.2.2-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.2.2-3">
<pre>
struct {
  uint64 tree_size;
  uint32 subtree_size;

  opaque reference_id&lt;0..2^8-1&gt;;
  Certificate chain&lt;0..2^8-1&gt;;
  opaque signature&lt;0..2^16-1&gt;;
} AddChainRequest;

struct {
  TreeHeadType tree_head_type;
  select (AddChainResponse.tree_head_type) {
    case provisional:
      ProvisionalTreeHead tree_head;
      CombinedTreeProof combined;
      PrefixProof prefix;
      SubtreeInclusionProof subtree;
  }
  BearerToken bearer_token;
} AddChainResponse;
</pre><a href="#section-4.2.2-3" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2-4">The request body is AddChainRequest. The <code>tree_size</code> field contains the size of
the most recent tree head observed by the client. The <code>subtree_size</code> field
contains the greatest size of the Certificate Subtree observed by the client.
The <code>reference_id</code> field contains the reference identifier that the certificate
chain will be validated against. The <code>chain</code> field contains the certificate
chain itself. The <code>signature</code> field contains a signature from the public key in
the leaf certificate over the following:<a href="#section-4.2.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2.2-5">TODO Specify signature challenge<a href="#section-4.2.2-5" class="pilcrow">¶</a></p>
<p id="section-4.2.2-6">The response body is AddChainResponse. If <code>tree_head_type</code> is set to <code>standard</code>,
this indicates that the exact certificate chain is already present in the
Certificate Subtree for the reference identifier and published in the rightmost
log entry. If <code>tree_head_type</code> is set to <code>provisional</code>, this indicates that a
provisional tree head has been issued for the chain. The provisional tree head
is given in <code>tree_head</code> and an inclusion proof in the provisional Prefix Tree is
given in <code>prefix</code>. The <code>combined</code> field contains the same contents as in the Get
Tree endpoint (<a href="#get-tree" class="auto internal xref">Section 4.2.1</a>). If <code>AddChainRequest.subtree_size</code> is greater than
zero, then <code>AddChainResponse.subtree.inclusion</code> is additionally a consistency
proof.<a href="#section-4.2.2-6" class="pilcrow">¶</a></p>
<p id="section-4.2.2-7">The <code>bearer_token</code> field of an AddChainResponse is arbitrarily set by the
Transparency Log and used to authenticate requests to the Transparency Log's
other endpoints. The bearer token will stop working once the associated
certificate chain has expired (regardless of revocation status).<a href="#section-4.2.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="refresh-proof">
<section id="section-4.2.3">
          <h4 id="name-refresh-proof">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-refresh-proof" class="section-name selfRef">Refresh Proof</a>
          </h4>
<p id="section-4.2.3-1">This endpoint is accessed by Site Operators to refresh a proof of inclusion for
their certificate chain, making it acceptable to clients for a longer period of
time.<a href="#section-4.2.3-1" class="pilcrow">¶</a></p>
<p id="section-4.2.3-2">GET /refresh-proof?bearer_token=X&amp;position=Y<a href="#section-4.2.3-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.2.3-3">
<pre>
struct {
  PrefixProof prefix;
  SubtreeInclusionProof subtree;
} RefreshProofResponse;
</pre><a href="#section-4.2.3-3" class="pilcrow">¶</a>
</div>
<p id="section-4.2.3-4">The request contains a bearer token obtained from the Add Chain endpoint
(<a href="#add-chain" class="auto internal xref">Section 4.2.2</a>) in the <code>bearer_token</code> query parameter, and the position of a log
entry in the <code>position</code> query parameter. The <code>position</code> query parameter <span class="bcp14">MUST</span>
either be the subsequent log entry issued after the provisional tree head (if
any) associated with <code>bearer_token</code>, or be a log entry issued less than or equal
to <code>max_behind</code> milliseconds in the past.<a href="#section-4.2.3-4" class="pilcrow">¶</a></p>
<p id="section-4.2.3-5">The response body is RefreshProofResponse. The <code>prefix</code> field contains a proof
of inclusion in the Prefix Tree stored at the requested log entry, specifically
for the reference identifier associated with <code>bearer_token</code>. The <code>subtree</code> field
contains an inclusion proof in the Certificate Subtree for the certificate chain
associated with <code>bearer_token</code>, as it existed in the requested log entry.<a href="#section-4.2.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="get-certificates">
<section id="section-4.2.4">
          <h4 id="name-get-certificates">
<a href="#section-4.2.4" class="section-number selfRef">4.2.4. </a><a href="#name-get-certificates" class="section-name selfRef">Get Certificates</a>
          </h4>
<p id="section-4.2.4-1">This endpoint is contacted by Site Operators for the purpose of auditing
certificates that have been issued for their domain names or IP addresses.<a href="#section-4.2.4-1" class="pilcrow">¶</a></p>
<p id="section-4.2.4-2">GET /get-certificates?bearer_token=X&amp;start=Y<a href="#section-4.2.4-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.2.4-3">
<pre>
struct {
  SubtreeLogLeaf leaves&lt;0..2^8-1&gt;;
} GetCertificatesResponse;
</pre><a href="#section-4.2.4-3" class="pilcrow">¶</a>
</div>
<p id="section-4.2.4-4">The request contains a bearer token obtained from the Add Chain endpoint
(<a href="#add-chain" class="auto internal xref">Section 4.2.2</a>) in the <code>bearer_token</code> query parameter, and the position to start
at in the Certificate Subtree in the <code>start</code> query parameter. The response body
is GetCertificatesResponse. The <code>leaves</code> field contains SubtreeLogLeaf
structures in the same order that they were sequenced in the Certificate Subtree
for whichever reference identifier is associated with <code>bearer_token</code>, starting
at position <code>start</code>.<a href="#section-4.2.4-4" class="pilcrow">¶</a></p>
<p id="section-4.2.4-5">The <code>start</code> query parameter <span class="bcp14">MUST</span> be greater than or equal to the smallest
<code>first_valid</code> field of any DomainCertificates structure for the associated
reference identifier that was published in a log entry with a timestamp less
than <code>maximum_lifetime</code> milliseconds in the past.<a href="#section-4.2.4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="add-revocation">
<section id="section-4.2.5">
          <h4 id="name-add-revocation">
<a href="#section-4.2.5" class="section-number selfRef">4.2.5. </a><a href="#name-add-revocation" class="section-name selfRef">Add Revocation</a>
          </h4>
<p id="section-4.2.5-1">This endpoint is contacted by Site Operators or Certificate Authorities for the
purpose of distributing revocations for their certificates.<a href="#section-4.2.5-1" class="pilcrow">¶</a></p>
<p id="section-4.2.5-2">POST /add-revocation<a href="#section-4.2.5-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.2.5-3">
<pre>
struct {
  Revocation revocation;
} AddRevocationRequest;
</pre><a href="#section-4.2.5-3" class="pilcrow">¶</a>
</div>
<p id="section-4.2.5-4">The request body is AddRevocationRequest. There is no response body; the HTTP
response status code will indicate success or failure of the submission. The
Transparency Log applies the revocation by updating any DomainCertificates
structures to exclude chains that are affected by the revocation. The revocation
<span class="bcp14">SHOULD</span> be applied to all DomainCertificates structures within <code>max_behind</code>
milliseconds.<a href="#section-4.2.5-4" class="pilcrow">¶</a></p>
<p id="section-4.2.5-5">TODO define Revocation type<a href="#section-4.2.5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="get-revocations">
<section id="section-4.2.6">
          <h4 id="name-get-revocations">
<a href="#section-4.2.6" class="section-number selfRef">4.2.6. </a><a href="#name-get-revocations" class="section-name selfRef">Get Revocations</a>
          </h4>
<p id="section-4.2.6-1">This endpoint is contacted by Site Operators to audit revocations affecting
their certificate chains.<a href="#section-4.2.6-1" class="pilcrow">¶</a></p>
<p id="section-4.2.6-2">GET /get-revocations?bearer_token=X{&amp;page=Y}<a href="#section-4.2.6-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.2.6-3">
<pre>
struct {
  Revocation revocations&lt;0..2^8-1&gt;;
  optional&lt;uint32&gt; next;
} GetRevocationsResponse;
</pre><a href="#section-4.2.6-3" class="pilcrow">¶</a>
</div>
<p id="section-4.2.6-4">The request contains a bearer token obtained from the Add Chain endpoint
(<a href="#add-chain" class="auto internal xref">Section 4.2.2</a>) in the <code>bearer_token</code> query parameter. Optionally, a page number
may be provided in the <code>page</code> query parameter. The <code>page</code> parameter <span class="bcp14">MUST</span> be a
value observed in the <code>next</code> field of a prior GetRevocationsResponse.<a href="#section-4.2.6-4" class="pilcrow">¶</a></p>
<p id="section-4.2.6-5">The response body is GetRevocationsResponse. The <code>revocations</code> field of the
response contains Revocation structures corresponding one-to-one with the
<code>invalid_entries</code> field of the most recent DomainCertificates structure. Note
that the most recent DomainCertificates structure may only have been published
in a provisional tree head at the time of the request. If the last entry of
<code>revocations</code> does not correspond to the last entry of <code>invalid_entries</code>, a page
number in <code>next</code> is provided to allow the client to make a follow-up request for
the next subset of revocations. The Transparency Log <span class="bcp14">MUST</span> set <code>next</code> such that,
if the <code>invalid_entries</code> field is modified while a client is requesting a series
of pages, the client will not miss any revocations that existed as of the first
request (with no <code>page</code> parameter) as a result.<a href="#section-4.2.6-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="tls-extension">
<section id="section-5">
      <h2 id="name-tls-extension">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-tls-extension" class="section-name selfRef">TLS Extension</a>
      </h2>
<p id="section-5-1">The following three subsections define the ClientHello, ServerHello, and
Certificate message portions of a TLS 1.3 extension. This extension allows the
host server to provide an inclusion proof for its certificate chain from a
Transparency Log that the client supports.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="clienthello">
<section id="section-5.1">
        <h3 id="name-clienthello">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-clienthello" class="section-name selfRef">ClientHello</a>
        </h3>
<p id="section-5.1-1">Clients include the extension in their ClientHello to communicate which
Transparency Logs they support and whether or not they have previously observed
a provisional inclusion proof from the server.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-5.1-2">
<pre>
struct {
  opaque value&lt;0..2^8-1&gt;;
} BearerToken;

struct {
  uint16 transparency_log_id;
  TreeHeadType tree_head_type;
  select (SupportedTransparencyLog.tree_head_type) {
    case standard:
      uint64 tree_size;
    case provisional:
      BearerToken bearer_token;
  }
} SupportedTransparencyLog;

struct {
  SupportedTransparencyLog supported&lt;0..2^8-1&gt;;
} TransparencyRequest;
</pre><a href="#section-5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.1-3">The extension has type "transparency_revocation" and consists of a serialized
<code>TransparencyRequest</code> structure in the "extension_data" field.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">Clients include an entry in the <code>supported</code> array for each Transparency Log
that they support receiving inclusion proofs from, containing the Transparency
Log's assigned unique identifier in <code>transparency_log_id</code>. The <code>supported</code> array
<span class="bcp14">MUST</span> be sorted in ascending order by <code>transparency_log_id</code>, and each
<code>transparency_log_id</code> <span class="bcp14">MUST</span> only be advertised once.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">If the client was shown a provisional inclusion proof in a previous
connection to the server, then they will have also received a bearer token and a
pre-shared key. For as long as the client has not yet seen the provisional
proof integrated into the subsequent log entry, and as long as the rightmost log
entry's timestamp is less than or equal to <code>10*max_behind</code> milliseconds in the
past, the client advertises a <code>provisional</code> tree head type and includes the
provided bearer token in <code>bearer_token</code>. If the server indicates the
Transparency Log in its ServerHello extension, the client will set the PSK
input to the TLS key schedule to be the pre-shared key.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">Clients that do not need to resolve a provisional inclusion proof advertise
a <code>standard</code> tree head type. The <code>tree_size</code> field is set as follows:<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-7.1">
            <p id="section-5.1-7.1.1">If the client is aware of two consecutive log entries where the timestamp
of the left log entry is greater than <code>max_behind</code> milliseconds in the past
and the timestamp of the right log entry is less than or equal to <code>max_behind</code>
milliseconds in the past, then the <code>tree_size</code> field is set so as to make the
right log entry the rightmost log entry.<a href="#section-5.1-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-7.2">
            <p id="section-5.1-7.2.1">If the client isn't aware of two log entries that meet the above criteria,
but is aware of a log entry whose timestamp is greater than <code>max_behind</code>
milliseconds in the past and less than <code>10*max_behind</code> milliseconds in the
past, then the <code>tree_size</code> field is set so as to make the rightmost such log
entry the rightmost log entry.<a href="#section-5.1-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-7.3">
            <p id="section-5.1-7.3.1">Otherwise, the <code>tree_size</code> field is set to 0.<a href="#section-5.1-7.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.1-8">With the first criteria, the client is aiming to advertise the
oldest <code>tree_size</code> that a server could provide an inclusion proof against
without it being expired. If the client is unable to do this, the second
criteria aims to advertise a <code>tree_size</code> that's old enough that it would not be
de-anonymizing, but not so old that servers are unaware of it.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="serverhello">
<section id="section-5.2">
        <h3 id="name-serverhello">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-serverhello" class="section-name selfRef">ServerHello</a>
        </h3>
<p id="section-5.2-1">Servers that receive a TLS 1.3 ClientHello with an extension of type
"transparency_revocation", where the <code>extension_data</code> field is properly formed,
have the option of providing an inclusion proof for their certificate chain. The
proof provided by the server <span class="bcp14">MUST</span> come from one of the Transparency Logs
advertised in the client's ClientHello. If the server is not able to provide a
proof from one of the client's supported Transparency Logs, it <span class="bcp14">MUST</span> respond as
if the ClientHello extension was not advertised at all. Servers <span class="bcp14">SHOULD</span>
preferentially respond with an inclusion proof from one of the Transparency Logs
that the client advertised a <code>provisional</code> tree head type for, provided that an
acceptable proof is readily available.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">If and only if the server intends to provide an inclusion proof (provisional or
not) from a Transparency Log where the client has advertised a <code>provisional</code>
tree head type, it includes an extension of type "transparency_revocation" in
its ServerHello. The <code>extension_data</code> is the unique identifier of the
Transparency Log:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-5.2-3">
<pre>
uint16 transparency_log_id;
</pre><a href="#section-5.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="certificate">
<section id="section-5.3">
        <h3 id="name-certificate">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-certificate" class="section-name selfRef">Certificate</a>
        </h3>
<p id="section-5.3-1">The server provides an inclusion proof for its certificate chain by adding
an extension of type "transparency_revocation" to the first CertificateEntry
structure in <code>certificate_list</code>. The <code>extension_data</code> field is a serialized
TransparencyProof structure:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div class="breakable lang-tls sourcecode" id="section-5.3-2">
<pre>
enum {
  reserved(0),
  standard(1),
  provisional(2),
  same_standard(3),
  same_provisional(4),
  (255)
} TransparencyProofType;

struct {
  uint32 size
  uint32 first_valid;
  uint32 invalid_entries&lt;0..2^8-1&gt;;
} SequencingProof;

struct {
  TreeHead tree_head;
  CombinedTreeProof combined;
  select (condition) {
    case true:
      SequencingProof sequencing;
  }
  SubtreeInclusionProof subtree;
} StandardProof;

struct {
  ProvisionalTreeHead tree_head;
  CombinedTreeProof combined;
  select (condition) {
    case true:
      SequencingProof sequencing;
  }

  PrefixProof prefix;
  SubtreeInclusionProof subtree;

  BearerToken bearer_token;
  opaque pre_shared_key&lt;16&gt;;
} ProvisionalProof;

struct {
  PrefixProof prefix;
  SubtreeInclusionProof subtree;
} SameStandardProof;

struct {
  uint32 position;
  InclusionProof inclusion;
} SameProvisionalProof;

struct {
  uint16 transparency_log_id;

  TransparencyProofType proof_type;
  select(TransparencyProof.proof_type) {
    case standard:
      StandardProof proof;
    case provisional:
      ProvisionalProof proof;
    case same_standard:
      SameStandardProof proof;
    case same_provisional:
      SameProvisionalProof proof;
  };
} TransparencyProof;
</pre><a href="#section-5.3-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3-3">The <code>transparency_log_id</code> field specifies the Transparency Log that the proof
comes from, while the <code>proof_type</code> field specifies the type of proof that
follows. Clients first verify that the Certificate Authority that issued the
presented certificate chain, and the Transparency Log identified by
<code>transparency_log_id</code>, are operated by different organizations. Verification
then proceeds as follows, based on <code>proof_type</code>:<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3-4">When <code>proof_type</code> is set to <code>standard</code>, this indicates that the inclusion proof
is against a log entry that is currently published by the Transparency Log but
more recent than the client may be aware of. These proofs are verified as
follows:<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-5">
<li id="section-5.3-5.1">
            <p id="section-5.3-5.1.1">Verify that <code>tree_head.size</code> is greater than the size of the tree head
advertised by the client.<a href="#section-5.3-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-5.2">
            <p id="section-5.3-5.2.1">Verify <code>combined</code> as executing the following proofs in this order:<a href="#section-5.3-5.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-5.2.2">
<li id="section-5.3-5.2.2.1">
                <p id="section-5.3-5.2.2.1.1">Updating the view of the tree (Section 10.3.1 of
<span>[<a href="#I-D.draft-ietf-keytrans-protocol" class="cite xref">I-D.draft-ietf-keytrans-protocol</a>]</span>). Note that verifying this proof step
also verifies that the rightmost log entry's timestamp is within the bounds
set by <code>max_ahead</code> and <code>max_behind</code>.<a href="#section-5.3-5.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-5.2.2.2">
                <p id="section-5.3-5.2.2.2.1">If a provisional tree head was advertised by the client and the subsequent
log entry is not the rightmost log entry, then the subsequent log entry's
timestamp and a <code>PrefixProof</code> from it are added to <code>combined</code>. (The
<strong>subsequent log entry</strong> is defined as the first log entry sequenced after
the provisional tree head was created.)<a href="#section-5.3-5.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-5.2.2.3">
                <p id="section-5.3-5.2.2.3.1">Finally, a <code>PrefixProof</code> from the rightmost log entry is added to
<code>combined</code>.<a href="#section-5.3-5.2.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.3-5.3">
            <p id="section-5.3-5.3.1">The <code>sequencing</code> field must be present when a provisional tree head was
advertised by the client and the subsequent log entry is not the rightmost log
entry. The <code>sequencing</code> field contains the size of the Certificate Subtree
and the <code>first_valid</code> and <code>invalid_entries</code> fields of the <code>DomainCertificates</code>
structure as it exists in the subsequent log entry. If present:<a href="#section-5.3-5.3.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-5.3.2">
<li id="section-5.3-5.3.2.1">
                <p id="section-5.3-5.3.2.1.1">Verify that <code>sequencing.size</code> is greater than or equal to the retained size
of the Certificate Subtree.<a href="#section-5.3-5.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-5.3.2.2">
                <p id="section-5.3-5.3.2.2.1">Verify that <code>sequencing.{first_valid, invalid_entries}</code> would not unrevoke
any previously-revoked certificates.<a href="#section-5.3-5.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.3-5.4">
            <p id="section-5.3-5.4.1">If the <code>sequencing</code> field is present, compare the following fields in
<code>subtree</code> against those in <code>sequencing</code>; if the <code>sequencing</code> field is not
present but the client advertised a provisional tree head, compare the fields
against the advertised provisional tree head:<a href="#section-5.3-5.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-5.4.2">
<li id="section-5.3-5.4.2.1">
                <p id="section-5.3-5.4.2.1.1">Verify that <code>subtree.size</code> is greater than or equal.<a href="#section-5.3-5.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-5.4.2.2">
                <p id="section-5.3-5.4.2.2.1">Verify that <code>subtree.{first_valid, invalid_entries}</code> would not unrevoke any
previously-revoked certificates.<a href="#section-5.3-5.4.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.3-5.5">
            <p id="section-5.3-5.5.1">Verify that <code>subtree.{first_valid, invalid_entries}</code> do not exclude
<code>subtree.position</code>.<a href="#section-5.3-5.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-5.6">
            <p id="section-5.3-5.6.1">Compute the root hash of the Log Tree and verify the signature in
<code>tree_head.signature</code>:<a href="#section-5.3-5.6.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-5.6.2">
<li id="section-5.3-5.6.2.1">
                <p id="section-5.3-5.6.2.1.1">Compute the root hash of the Certificate Subtree as it exists in the
rightmost log entry. If the <code>sequencing</code> field is present, also compute the
root hash of the Certificate Subtree as it exists in the subsequent log
entry. Both of these are done by interpreting <code>subtree.inclusion</code> as a proof
of inclusion in the Certificate Subtree for <code>subtree.position</code>. If the
<code>sequencing</code> field is present, <code>subtree.inclusion</code> additionally contains the
minimum set of node hashes necessary to compute the root of the Certificate
Subtree at size <code>sequencing.size</code>. If the client advertised a provisional
tree head, the full subtrees of the Certificate Subtree as it existed in the
advertised tree head are assumed to be known and will not be repeated.<a href="#section-5.3-5.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-5.6.2.2">
                <p id="section-5.3-5.6.2.2.1">With the root hash of the Certificate Subtree and the other fields in
<code>subtree</code>, compute the Prefix Tree leaf hash for the rightmost log entry. If
the <code>sequencing</code> field is present, use the fields of <code>sequencing</code> to compute
the Prefix Tree leaf hash for the subsequent log entry.<a href="#section-5.3-5.6.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-5.6.2.3">
                <p id="section-5.3-5.6.2.3.1">With the Prefix Tree leaf hash(es), compute the root hash of the Log Tree
with <code>combined</code>. Note that the full subtrees of the Log Tree advertised by
the client are assumed to already be known and will not be repeated.<a href="#section-5.3-5.6.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
        </ol>
<p id="section-5.3-6">When <code>proof_type</code> is set to <code>provisional</code>, this indicates that the inclusion
proof is against a log entry that is not yet published by the Transparency Log.
These proofs are verified as follows:<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-7">
<li id="section-5.3-7.1">
            <p id="section-5.3-7.1.1">If the client advertised a <code>standard</code> tree head type, verify that
<code>tree_head.size</code> is greater than or equal to that of the advertised tree head.
If the client advertised a <code>provisional</code> tree head type, verify that
<code>tree_head.size</code> is greater than that of the advertised tree head, or that
<code>tree_head.size</code> is equal and <code>tree_head.counter</code> is greater than that of the
advertised tree head.<a href="#section-5.3-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-7.2">
            <p id="section-5.3-7.2.1">Verify <code>combined</code> as executing the following proofs in this order:<a href="#section-5.3-7.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-7.2.2">
<li id="section-5.3-7.2.2.1">
                <p id="section-5.3-7.2.2.1.1">Updating the view of the tree (Section 10.3.1 of
<span>[<a href="#I-D.draft-ietf-keytrans-protocol" class="cite xref">I-D.draft-ietf-keytrans-protocol</a>]</span>). Note that verifying this proof step
also verifies that the rightmost log entry's timestamp is within the bounds
set by <code>max_ahead</code> and <code>max_behind</code>.<a href="#section-5.3-7.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-7.2.2.2">
                <p id="section-5.3-7.2.2.2.1">If a provisional tree head was advertised by the client and the subsequent
log entry exists, then the subsequent log entry's timestamp and a
<code>PrefixProof</code> from it are added to <code>combined</code>.<a href="#section-5.3-7.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.3-7.3">
            <p id="section-5.3-7.3.1">The <code>sequencing</code> field must be present when a provisional tree head was
advertised by the client and the subsequent log entry exists. The <code>sequencing</code>
field contains the size of the Certificate Subtree and the <code>first_valid</code> and
<code>invalid_entries</code> fields of the <code>DomainCertificates</code> structure as it exists in
the subsequent log entry. If present:<a href="#section-5.3-7.3.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-7.3.2">
<li id="section-5.3-7.3.2.1">
                <p id="section-5.3-7.3.2.1.1">Verify that <code>sequencing.size</code> is greater than or equal to the retained size
of the Certificate Subtree.<a href="#section-5.3-7.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-7.3.2.2">
                <p id="section-5.3-7.3.2.2.1">Verify that <code>sequencing.{first_valid, invalid_entries}</code> would not unrevoke
any previously-revoked certificates.<a href="#section-5.3-7.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.3-7.4">
            <p id="section-5.3-7.4.1">If the <code>sequencing</code> field is present, compare the following fields in
<code>subtree</code> against those in <code>sequencing</code>; if the <code>sequencing</code> field is not
present but the client advertised a provisional tree head, compare the fields
against the advertised provisional tree head:<a href="#section-5.3-7.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-7.4.2">
<li id="section-5.3-7.4.2.1">
                <p id="section-5.3-7.4.2.1.1">Verify that <code>subtree.size</code> is greater than or equal.<a href="#section-5.3-7.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-7.4.2.2">
                <p id="section-5.3-7.4.2.2.1">Verify that <code>subtree.{first_valid, invalid_entries}</code> would not unrevoke any
previously-revoked certificates.<a href="#section-5.3-7.4.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.3-7.5">
            <p id="section-5.3-7.5.1">Verify that <code>subtree.{first_valid, invalid_entries}</code> do not exclude
<code>subtree.position</code>.<a href="#section-5.3-7.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-7.6">
            <p id="section-5.3-7.6.1">Compute the root hash of the Log Tree and the root hash of the provisional
Prefix Tree:<a href="#section-5.3-7.6.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-7.6.2">
<li id="section-5.3-7.6.2.1">
                <p id="section-5.3-7.6.2.1.1">Compute the root hash of the Certificate Subtree as it exists in the
provisional Prefix Tree. If the <code>sequencing</code> field is present, also compute
the root hash of the Certificate Subtree as it exists in the subsequent log
entry. Both of these are done by interpreting <code>subtree.inclusion</code> as a proof
of inclusion in the Certificate Subtree for <code>subtree.position</code>. If the
<code>sequencing</code> field is present, <code>subtree.inclusion</code> additionally contains the
minimum set of node hashes necessary to compute the root of the Certificate
Subtree at size <code>sequencing.size</code>. If the client advertised a provisional
tree head, the full subtrees of the Certificate Subtree as it existed in the
advertised tree head are assumed to be known and will not be repeated.<a href="#section-5.3-7.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-7.6.2.2">
                <p id="section-5.3-7.6.2.2.1">With the root hash of the Certificate Subtree and the other fields in
<code>subtree</code>, compute the Prefix Tree leaf hash for the provisional Prefix
Tree. If the <code>sequencing</code> field is present, use the fields of <code>sequencing</code>
to compute the Prefix Tree leaf hash for the subsequent log entry.<a href="#section-5.3-7.6.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-7.6.2.3">
                <p id="section-5.3-7.6.2.3.1">Compute the root hash of the Log Tree with <code>combined</code> (which may require the
Prefix Tree leaf hash for the subsequent log entry). Note that the full
subtrees of the Log Tree advertised by the client are assumed to already be
known and will not be repeated.<a href="#section-5.3-7.6.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-7.6.2.4">
                <p id="section-5.3-7.6.2.4.1">With the provisional Prefix Tree leaf hash and the proof in <code>prefix</code>,
compute the provisional Prefix Tree root hash.<a href="#section-5.3-7.6.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
          <li id="section-5.3-7.7">
            <p id="section-5.3-7.7.1">Verify the signature in <code>tree_head.signature</code>.<a href="#section-5.3-7.7.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-5.3-8">When <code>proof_type</code> is set to <code>same_standard</code>, this indicates that the inclusion
proof is against the same tree head that was specified in the
<code>SupportedTransparencyLog</code> structure for the chosen Transparency Log. These
proofs are verified as follows:<a href="#section-5.3-8" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-9">
<li id="section-5.3-9.1">
            <p id="section-5.3-9.1.1">Verify that the client advertised a standard tree head type for the chosen
Transparency Log.<a href="#section-5.3-9.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-9.2">
            <p id="section-5.3-9.2.1">For the advertised tree head, verify that the rightmost log entry's timestamp
is within the bounds set by <code>max_ahead</code> and <code>max_behind</code>.<a href="#section-5.3-9.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-9.3">
            <p id="section-5.3-9.3.1">Verify that <code>subtree.{first_valid, invalid_entries}</code> do not exclude
<code>subtree.position</code>.<a href="#section-5.3-9.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-9.4">
            <p id="section-5.3-9.4.1">Compute the root hash of the Prefix Tree and verify that it matches the
retained value:<a href="#section-5.3-9.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-9.4.2">
<li id="section-5.3-9.4.2.1">
                <p id="section-5.3-9.4.2.1.1">Compute the root hash of the Certificate Subtree by interpreting
<code>subtree.inclusion</code> as a proof of inclusion in the Certificate Subtree for
the log entry at <code>subtree.position</code>.<a href="#section-5.3-9.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-9.4.2.2">
                <p id="section-5.3-9.4.2.2.1">With the root hash of the Certificate Subtree and the other fields in
<code>subtree</code>, compute the Prefix Tree leaf hash.<a href="#section-5.3-9.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-5.3-9.4.2.3">
                <p id="section-5.3-9.4.2.3.1">With the Prefix Tree leaf hash and the proof in <code>prefix</code>, compute the Prefix
Tree root hash.<a href="#section-5.3-9.4.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
        </ol>
<p id="section-5.3-10">When <code>proof_type</code> is set to <code>same_provisional</code>, this indicates that the
inclusion proof is against the same provisional tree head that was previously
provided by the server. These proofs are verified as follows:<a href="#section-5.3-10" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-11">
<li id="section-5.3-11.1">
            <p id="section-5.3-11.1.1">Verify that the client advertised a provisional tree head type for the chosen
Transparency Log.<a href="#section-5.3-11.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-11.2">
            <p id="section-5.3-11.2.1">For the advertised tree head, verify that the rightmost log entry's timestamp
is within the bounds set by <code>max_ahead</code> and <code>max_behind</code>.<a href="#section-5.3-11.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-11.3">
            <p id="section-5.3-11.3.1">Verify that the previously-retained <code>first_valid</code> and <code>invalid_entries</code> fields
do not exclude <code>position</code>.<a href="#section-5.3-11.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-11.4">
            <p id="section-5.3-11.4.1">Compute the root hash of the Certificate Subtree by interpreting <code>inclusion</code>
as a proof of inclusion in the Certificate Subtree for the log entry at
<code>position</code>. The full subtrees are assumed to already be known, meaning they
will not be repeated. Verify that the computed value matches the retained
value.<a href="#section-5.3-11.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-5.3-12">As was mentioned in <a href="#structure" class="auto internal xref">Section 4.1</a>, the entire certificate chain that will be
presented by the server is stored in the leaf of the Certificate Subtree. If the
server presents a different certificate chain to the client than was logged in
the Transparency Log (for example by including or omitting intermediates), the
client will be unable to compute the correct Certificate Subtree root hash and
proof verification will fail. Authenticating the entire certificate chain,
instead of just the leaf, prevents the possibility of unlogged intermediate
certificates. That is, it prevents the possibility of a leaf certificate being
logged with a chain to a testing (or otherwise untrusted) trust anchor, and then
being presented in TLS connections with additional intermediates that connect it
to a different trust anchor.<a href="#section-5.3-12" class="pilcrow">¶</a></p>
<p id="section-5.3-13">Similarly, the reference identifier for the leaf certificate (the registrable
domain or IP address) determines where in the Prefix Tree the Transparency Log
stores the certificate chain. If the server attempts to present the certificate
for a different reference identifier, the client will be unable to verify the
proof. However, the ability of clients to enforce that certificates are organized
into the Transparency Log correctly is the core reason that Site Operators don't
need to download the entire contents of the Transparency Log to find all
certificates that are relevant to them.<a href="#section-5.3-13" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="extended-resolution-mechanisms">
<section id="section-6">
      <h2 id="name-extended-resolution-mechani">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-extended-resolution-mechani" class="section-name selfRef">Extended Resolution Mechanisms</a>
      </h2>
<p id="section-6-1">When clients observe a provisional inclusion proof, they retain condensed state
about the proof until they observe that the associated certificate chain was
properly included in the subsequent log entry. The primary mechanism by which
clients are expected to observe this is through future connections to the same
server. However, this may fail to happen for various reasons. The client may not
wish to contact the server again within the allotted time, the server may go
offline, or the server may simply decline to respond with a proof from the same
Transparency Log. As such, additional mechanisms are described to enable the
client to reach resolution on all provisional inclusion proofs it observes.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="background-requests">
<section id="section-6.1">
        <h3 id="name-background-requests">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-background-requests" class="section-name selfRef">Background Requests</a>
        </h3>
<p id="section-6.1-1">When a client has an unresolved provisional inclusion proof, where the rightmost
log entry's timestamp is between <code>5*max_behind</code> and <code>10*max_behind</code> milliseconds
in the past, the client <span class="bcp14">SHOULD</span> attempt a single background request to the server
that provided the proof. A <strong>background request</strong> is a connection attempt that
is not initiated by a user and will not carry user request data. The client
should advertise in its ClientHello only <code>provisional</code> tree head types where the
rightmost log entry has a timestamp more than <code>max_behind</code> milliseconds in the
past. If the connection succeeds, any certificate the server responds with will
necessarily provide the information the client needs to purge a
previously-observed provisional inclusion proof from its state. Any additional
provisional inclusion proof provided by the server in such a connection should
be disregarded, rather than triggering new state to be stored.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="oblivious-third-party">
<section id="section-6.2">
        <h3 id="name-oblivious-third-party">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-oblivious-third-party" class="section-name selfRef">Oblivious Third Party</a>
        </h3>
<p id="section-6.2-1">If provided, clients may also attempt to contact a third-party service
(potentially operated by their software vendor) to request proof that a
subsequent log entry is constructed correctly. Such an endpoint could be
contacted over Oblivious HTTP <span>[<a href="#RFC9458" class="cite xref">RFC9458</a>]</span> to preserve the client's privacy.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="final-reporting">
<section id="section-6.3">
        <h3 id="name-final-reporting">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-final-reporting" class="section-name selfRef">Final Reporting</a>
        </h3>
<p id="section-6.3-1">If a client has been unable to resolve a provisional inclusion proof on its own,
and the rightmost log entry's timestamp is more than <code>10*max_behind</code>
milliseconds in the past, the client <span class="bcp14">MUST</span> report the provisional inclusion proof
to a party distinct from the issuing Certificate Authority and the operator of
the Transparency Log. The client can then delete the associated state at its
discretion.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">The purpose of reporting provisional inclusion proofs that are unable to be
resolved is to ensure that there is broader ecosystem awareness of a potential
issue with the Transparency Log. The extent to which there was any malicious
behavior or operational errors, and any corrective action that should be taken,
would need to be decided out-of-band.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="operational-considerations">
<section id="section-7">
      <h2 id="name-operational-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<div id="client-state">
<section id="section-7.1">
        <h3 id="name-client-state">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-client-state" class="section-name selfRef">Client State</a>
        </h3>
<p id="section-7.1-1">Clients retain the following state:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.1">
            <p id="section-7.1-2.1.1">For each fork of each trusted Transparency Log:<a href="#section-7.1-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.1.2.1">
                <p id="section-7.1-2.1.2.1.1">The timestamp and Prefix Tree root hash for any observed log entries that
may be useful to advertise in the client's ClientHello:<a href="#section-7.1-2.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.1.2.1.2.1">
                    <p id="section-7.1-2.1.2.1.2.1.1">All observed log entries with a timestamp less than or equal to
<code>max_behind</code> milliseconds in the past.<a href="#section-7.1-2.1.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="normal" id="section-7.1-2.1.2.1.2.2">
                    <p id="section-7.1-2.1.2.1.2.2.1">The rightmost observed log entry with a timestamp more than <code>max_behind</code>
milliseconds in the past.<a href="#section-7.1-2.1.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="section-7.1-2.1.2.2">
                <p id="section-7.1-2.1.2.2.1">Any intermediate Log Tree nodes that are necessary to compute the most
recent Log Tree root hash from the retained log entries.<a href="#section-7.1-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-7.1-2.2">
            <p id="section-7.1-2.2.1">For each provisional inclusion proof observed that has not been replaced with
a superseding provisional inclusion proof, or been shown to be included in the
subsequent log entry:<a href="#section-7.1-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1-2.2.2.1">
                <p id="section-7.1-2.2.2.1.1">The registrable domain or IP address of the host that presented the
provisional proof.<a href="#section-7.1-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.1-2.2.2.2">
                <p id="section-7.1-2.2.2.2.1">The ProvisionalTreeHead structure.<a href="#section-7.1-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.1-2.2.2.3">
                <p id="section-7.1-2.2.2.3.1">The full subtrees of the Log Tree, as presented in the provisional proof.<a href="#section-7.1-2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.1-2.2.2.4">
                <p id="section-7.1-2.2.2.4.1">The <code>size</code>, <code>first_valid</code>, and <code>invalid_entries</code> fields of the
<code>SubtreeInclusionProof</code> structure.<a href="#section-7.1-2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.1-2.2.2.5">
                <p id="section-7.1-2.2.2.5.1">The full subtrees of the Certificate Subtree.<a href="#section-7.1-2.2.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-7.1-2.2.2.6">
                <p id="section-7.1-2.2.2.6.1">The bearer token and pre-shared key associated with the provisional
inclusion proof.<a href="#section-7.1-2.2.2.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-7.1-3">Clients <span class="bcp14">MUST</span> only update their stored state once a proof has been fully and
successfully verified. In addition, clients <span class="bcp14">MUST</span> be able to handle being shown
forked views of a Transparency Log.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">When a client advertises a provisional tree head to the server and the server
responds with a standard proof type, the server's response will necessarily
include proof that the certificate in the provisional tree head was correctly
included in the subsequent log entry. As such, the information retained about
the provisional inclusion proof is deleted. Similarly, when a client advertises
a provisional tree head to the server and the server responds with a provisional
proof type, the server's response will contain proof that the new provisional
inclusion proof supersedes (i.e., contains all the same certificates as) the
previous one. As such, state for the previous provisional inclusion proof is
deleted and replaced with state for the new one.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">Regardless of whether the server responds with a standard or provisional proof
type, if the server presents a new view of the Log Tree that the client was
previously unaware of, the client retains this new view for later use. If
possible, the client stores the new view as an extension of a
previously-observed view of the Transparency Log. However, if the view is
inconsistent with what the client has previously observed, then it is stored as
a new independent fork.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="server-behavior">
<section id="section-7.2">
        <h3 id="name-server-behavior">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-server-behavior" class="section-name selfRef">Server Behavior</a>
        </h3>
<p id="section-7.2-1">To prevent connection failure, it's critical that servers that implement the TLS
extension in <a href="#tls-extension" class="auto internal xref">Section 5</a> always have a satisfactory proof to offer to
clients. Servers <span class="bcp14">MUST</span> implement the automatic refreshing of proofs and <span class="bcp14">MUST</span>
implement automatic failover between multiple trusted Transparency Logs in the
event that one is temporarily unavailable.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">Along this same line, it's also possible for a Transparency Log to sequence
incorrect information and no longer be able to provide acceptable proofs. This
can happen, for example, if a Transparency Log issues a provisional inclusion
proof for a certificate and then neglects to include the certificate in the
subsequent log entry. This is functionally equivalent to a prolonged outage, as
the server is unable to obtain an acceptable inclusion proof for its
certificate. As such, servers <span class="bcp14">MUST</span> verify proofs in the same manner as clients
and avoid serving proofs that fail verification, failing over to another
Transparency Log if necessary to get an acceptable proof.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">Given the substantial load that may be placed on Transparency Logs, especially
in scenarios where one log's traffic is failing over to others, servers have a
responsibility to minimize their individual impact on logs. Servers <span class="bcp14">SHOULD NOT</span>
attempt to refresh an inclusion proof from a Transparency Log until the
rightmost log entry's timestamp in the current inclusion proof is more than
<code>max_behind*3/4</code> milliseconds in the past. Servers <span class="bcp14">SHOULD NOT</span> contact a
Transparency Log about the same inclusion proof more than 3 times within
<code>max_behind</code> milliseconds.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2-4">Finally, servers <span class="bcp14">MUST</span> generate the bearer tokens that are provided to clients in
a way that, when the bearer token is advertised back to the server, does not
degrade the client's privacy. One suggested way to do this would be to make the
bearer token a symmetric encryption of an identifier for the associated
provisional certificate along with a 12- or 16-byte random value. The random
value would then be used to compute the pre-shared key to give the client. When
the client later advertises the bearer token back, it can be decrypted by the
server to identify the provisional certificate to respond with and to re-compute
the pre-shared key for the connection. This minimizes the operational burden on
the server and also effectively preserves client privacy.<a href="#section-7.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="handling-forks">
<section id="section-7.3">
        <h3 id="name-handling-forks">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-handling-forks" class="section-name selfRef">Handling Forks</a>
        </h3>
<p id="section-7.3-1">There are several long-term expectations placed on Transparency Logs that, in
practice, will almost certainly fail to be upheld. In particular, Transparency
Logs are generally expected to be append-only, meaning that log entries are never
removed once they've been added. However, enforcing this strictly is
incompatible with many of the standard best-practices for operating reliable
software systems. For example, if this property needed to be enforced strictly,
it would pointless to back up such a Transparency Log. Restoring from backup
would imply some degree of rollback and this would be unacceptable. As such, it
is necessary for the protocol to handle reasonable violations of these
expectations gracefully, and in a way that preserves overall security.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">As discussed in <a href="#client-state" class="auto internal xref">Section 7.1</a>, clients <span class="bcp14">MUST</span> be able to handle forked views of
a Transparency Log gracefully. When a client becomes aware of a fork, it <span class="bcp14">MUST</span>
report the fork to a party distinct from the issuing Certificate Authority and
the operator of the Transparency Log. Going forward, as long as the client is
aware of multiple forks where the timestamps of the rightmost log entries differ
by less than <code>max_behind</code> milliseconds, the client <span class="bcp14">MUST NOT</span> advertise in its
ClientHello a <code>standard</code> tree head type with a tree size past where any such
fork occurs. This minimizes the risk of connection failure when connecting to
servers that have inclusion proofs from different forks.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
<p id="section-7.3-3">If a client advertised a non-zero <code>standard</code> tree head type and proof
verification failed only at the final signature verification step (or at direct
comparison of the Prefix Tree root hash, in the case of <code>SameStandardProof</code>), this may
indicate that there is a fork the client is unaware of. The client <span class="bcp14">SHOULD</span>
attempt to reconnect to the server while advertising a zero <code>standard</code> tree head
type. This will prompt the server to provide additional intermediate nodes,
allowing the client to compute the correct Log Tree root hash for signature
verification to succeed.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
<p id="section-7.3-4">Excluding the production of forks, the other ways that a Transparency Log can
fail are much simpler to handle because we know that the client and server agree
on the state of the log. These cases are handled by the provisions of
<a href="#server-behavior" class="auto internal xref">Section 7.2</a>.<a href="#section-7.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="certificate-authority">
<section id="section-8">
      <h2 id="name-certificate-authority">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-certificate-authority" class="section-name selfRef">Certificate Authority</a>
      </h2>
<div id="poison-extension">
<section id="section-8.1">
        <h3 id="name-poison-extension">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-poison-extension" class="section-name selfRef">Poison Extension</a>
        </h3>
<p id="section-8.1-1">A trivial downgrade attack is possible where a host refuses to acknowledge the
presence of the "transparency_revocation" TLS extension in an attempt to circumvent
the stronger transparency or non-revocation requirements. Customers of a
Certificate Authority can mitigate such an attack by including a special
non-critical poison extension (OID TODO, whose extnValue OCTET STRING contains
ASN.1 NULL data (0x05 0x00)) in all certificates they issue.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">Clients that advertise the "transparency_revocation" extension in their
ClientHello <span class="bcp14">MUST</span> reject a certificate that contains the extension if it is not
provided with an appropriate inclusion proof.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="performance-considerations">
<section id="section-9">
      <h2 id="name-performance-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-performance-considerations" class="section-name selfRef">Performance Considerations</a>
      </h2>
<p id="section-9-1">This section contains brief analysis of the performance impacts of the system.<a href="#section-9-1" class="pilcrow">¶</a></p>
<div id="transparency-log-1">
<section id="section-9.1">
        <h3 id="name-transparency-log-2">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-transparency-log-2" class="section-name selfRef">Transparency Log</a>
        </h3>
<p id="section-9.1-1"><strong>Storage.</strong> The storage of a Transparency Log is long-term bounded (i.e.,
Transparency Logs will not grow infinitely) and is dominated by the cost of
storing <em>unexpired</em> certificate chains. Certificate chains can be purged once
they have expired and are at the leftmost edge of the Certificate Subtree. Any
associated revocations can be purged once the associated certificate chains have
been. Subtrees of the Log Tree and Prefix Tree may be purged once they are no
longer necessary to the protocol. For specific leaves of the Log Tree, this
occurs once they are older than <code>maximum_lifetime</code> milliseconds. For subtrees of
the Prefix Tree, this occurs once all certificate chains stored in the subtree
have expired.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2"><strong>Bandwidth.</strong> A TLS server maintaining a valid proof of inclusion for a single
certificate chain is expected to make the following requests to a Transparency
Log:<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9.1-3">
<li id="section-9.1-3.1">
            <p id="section-9.1-3.1.1">When a new certificate chain is first issued, the server will initialize its
state (a Get Tree request) and submit the chain to receive a provisional
inclusion proof (an Add Chain request).<a href="#section-9.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-9.1-3.2">
            <p id="section-9.1-3.2.1">From then on, the server will regularly obtain the most recent tree head (a
Get Tree request with the <code>tree_size</code> parameter provided) and refresh its
proof of inclusion (a Refresh Proof request).<a href="#section-9.1-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-9.1-4">The table below provides formulas for the size in bytes of the Transparency
Log's response to each query. Each variable in the formulas is also given a
"typical" value which is used to estimate the total bandwidth commitment of a
Transparency Log.<a href="#section-9.1-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-9.1-5">
          <dt id="section-9.1-5.1"><strong>S</strong></dt>
          <dd style="margin-left: 1.5em" id="section-9.1-5.2">
            <p id="section-9.1-5.2.1">The size of one cryptographic signature in bytes. For the purpose of computing
an estimate, S is assumed to be 64 bytes as this is the size of a typical
elliptic curve signature.<a href="#section-9.1-5.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-5.3"><strong>N</strong></dt>
          <dd style="margin-left: 1.5em" id="section-9.1-5.4">
            <p id="section-9.1-5.4.1">The height of the Log Tree. Based on a Transparency Log that sequences two new
log entries per day, and that has been operating for 365 days, N is estimated
to be 11.<a href="#section-9.1-5.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-5.5"><strong>P</strong></dt>
          <dd style="margin-left: 1.5em" id="section-9.1-5.6">
            <p id="section-9.1-5.6.1">The average height of the Prefix Tree. Based on a Transparency Log that stores
300 million unique identifiers, P is estimated to be 30.<a href="#section-9.1-5.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-9.1-5.7"><strong>M</strong></dt>
          <dd style="margin-left: 1.5em" id="section-9.1-5.8">
            <p id="section-9.1-5.8.1">The average height of a Certificate Subtree. Based on an assumption that a
typical Site Operator will issue several hundred certificates, M is estimated
to be 10.<a href="#section-9.1-5.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Response Type</th>
              <th class="text-left" rowspan="1" colspan="1">Formula</th>
              <th class="text-left" rowspan="1" colspan="1">Estimated Size</th>
              <th class="text-left" rowspan="1" colspan="1">Count</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">GetTreeResponse (full)</td>
              <td class="text-left" rowspan="1" colspan="1">694 + S + 52*N</td>
              <td class="text-left" rowspan="1" colspan="1">1330</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">GetTreeResponse (abridged)</td>
              <td class="text-left" rowspan="1" colspan="1">54 + S</td>
              <td class="text-left" rowspan="1" colspan="1">118</td>
              <td class="text-left" rowspan="1" colspan="1">179</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">AddChainResponse</td>
              <td class="text-left" rowspan="1" colspan="1">51 + S + 32<em>P + 32</em>M</td>
              <td class="text-left" rowspan="1" colspan="1">1395</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">RefreshProofResponse</td>
              <td class="text-left" rowspan="1" colspan="1">15 + 32*P</td>
              <td class="text-left" rowspan="1" colspan="1">975</td>
              <td class="text-left" rowspan="1" colspan="1">179</td>
            </tr>
          </tbody>
        </table>
<p id="section-9.1-7">The "Count" column of the table contains the number of times each response will
be served to a client, assuming a certificate lifetime of 3 months and that the
server refreshes its proof twice every day and a half. As such, it's estimated
that supporting a single Site Operator requires an outbound bandwidth commitment
from a Transparency Log of approximately 0.2 bits per second.<a href="#section-9.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tls-server">
<section id="section-9.2">
        <h3 id="name-tls-server">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-tls-server" class="section-name selfRef">TLS Server</a>
      </h3>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-10">
      <h2 id="name-security-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="clienthello-extension">
<section id="section-10.1">
        <h3 id="name-clienthello-extension">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-clienthello-extension" class="section-name selfRef">ClientHello Extension</a>
        </h3>
<p id="section-10.1-1">Given that ClientHello extensions are sent unencrypted, this portion of the
extension was designed to avoid unnecessary privacy leaks. In particular, care
was taken to avoid leaking what certificate(s) the client may have been
shown in previous connections and what other hosts the client may have
contacted recently.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">Clients advertise a recently observed tree size for each Transparency Log
that they support receiving inclusion proofs from. Since clients will
generally only "observe" various tree sizes of a Transparency Log by
communicating with hosts that provide proofs from that Transparency Log, and
since different hosts will update their proofs at different times, this may
cause a privacy leak. Specifically, it could happen that a client
communicates with a host that uses proofs from a very recently-created tree
size. If the client advertised this very recently-created tree size to other
hosts, it would reveal who they previously communicated with.<a href="#section-10.1-2" class="pilcrow">¶</a></p>
<p id="section-10.1-3">To mitigate this, clients only advertise tree sizes where the timestamp of
the rightmost log entry is sufficiently old. This time delay ensures that
the inclusion proof provided by almost any host could've conveyed the same
tree size, creating a large anonymity set.<a href="#section-10.1-3" class="pilcrow">¶</a></p>
<p id="section-10.1-4">When a client observes a provisional inclusion proof from a host, they
retain condensed information about it to allow them to later verify that the
information it contained was properly integrated into the Transparency Log. The
primary avenue for obtaining this verification is advertising knowledge of the
provisional proof back to the host that it came from, hoping to get the
necessary information in-band.<a href="#section-10.1-4" class="pilcrow">¶</a></p>
<p id="section-10.1-5">Since provisional inclusion proofs must be issued quickly, they don't have
time to build up a large anonymity set with other hosts. Instead of having clients
advertise knowledge of a specific provisional proof in their ClientHello,
they instead use a bearer token that was provided by the host. This bearer token
is provided in the encrypted Certificate message the first time that the
provisional proof is used by the host. Similarly, when the bearer token is
redeemed (i.e., when the host shows that the provisional proof was correctly
integrated into the Transparency Log), this information is provided in the
encrypted Certificate message. As such, assuming that the bearer token is
generated by the host in a secure way, a passive network
observer never sees anything that would identify the certificate shown to the
client.<a href="#section-10.1-5" class="pilcrow">¶</a></p>
<p id="section-10.1-6">Each bearer token is additionally associated with a pre-shared key which is
provided to the TLS key schedule. This prevents an active attacker from
establishing a TLS connection to the host, advertising an observed bearer token,
and learning which certificate is provided.<a href="#section-10.1-6" class="pilcrow">¶</a></p>
<p id="section-10.1-7">Finally, note that it is not a goal to prevent an attacker from learning whether
a client has previously contacted a host <em>at all</em> before. The protocol
explicitly relies on the client's stored state to send as little data over
the wire as possible. A passive observer of network traffic could trivially
determine from the size of the encrypted portion of the handshake messages
whether such state was present or not, and therefore whether the host had been
contacted before. Similarly, it is not a goal to prevent a host from identifying
the same client over many connections.<a href="#section-10.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="downgrade-prevention">
<section id="section-10.2">
        <h3 id="name-downgrade-prevention">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-downgrade-prevention" class="section-name selfRef">Downgrade Prevention</a>
        </h3>
<p id="section-10.2-1">The stronger transparency and non-revocation guarantees this protocol provides
would be irrelevant if a malicious actor could cause the TLS client to disable
them at-will. An attacker may have, for example, a revoked certificate to which
they know the private key. This would allow them to fully intercept a client's
connection to a host and attempt to impersonate the host. In a
downgraded version of TLS, the client may not enforce revocation at all and
therefore the attacker's interception would succeed.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<p id="section-10.2-2">Site Operators that have deployed this protocol and wish to prevent capable TLS
clients from being downgraded can include a poison extension in their TLS
certificates, as described in <a href="#poison-extension" class="auto internal xref">Section 8.1</a>. The poison extension will be
silently ignored by TLS clients that genuinely do not support it, but will cause
updated clients to abort the protocol in downgrade scenarios.<a href="#section-10.2-2" class="pilcrow">¶</a></p>
<p id="section-10.2-3">Site Operators can monitor the existing <span>[<a href="#RFC6962" class="cite xref">RFC6962</a>]</span> ecosystem to detect
any certificates that have been issued without the poison extension,
potentially permitting downgrades. However, the creation of such a certificate
without the Site Operator's consent would imply mis-issuance by a Certificate
Authority rather than abuse of a compromised/revoked certificate.<a href="#section-10.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<ul class="normal">
<li class="normal" id="section-11-1.1">
          <p id="section-11-1.1.1">Codepoint for TLS extension "transparency_revocation"<a href="#section-11-1.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-11-1.2">
          <p id="section-11-1.2.1">Registry for transparency_log_id(?)<a href="#section-11-1.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-11-1.3">
          <p id="section-11-1.3.1">OID for poison extension<a href="#section-11-1.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="sec-combined-references">
<section id="section-12">
      <h2 id="name-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-12.1">
        <h3 id="name-normative-references">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.draft-ietf-keytrans-protocol">[I-D.draft-ietf-keytrans-protocol]</dt>
        <dd>
<span class="refAuthor">McMillion, B.</span> and <span class="refAuthor">F. Linker</span>, <span class="refTitle">"Key Transparency Protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-keytrans-protocol-00</span>, <time datetime="2024-12-10" class="refDate">10 December 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-keytrans-protocol-00">https://datatracker.ietf.org/doc/html/draft-ietf-keytrans-protocol-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-12.2">
        <h3 id="name-informative-references">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="ct-in-wild">[ct-in-wild]</dt>
        <dd>
<span class="refAuthor">Li, B.</span>, <span class="refTitle">"Certificate Transparency in the Wild: Exploring the Reliability of Monitors"</span>, <time datetime="2019-11-06" class="refDate">6 November 2019</time>, <span>&lt;<a href="https://dl.acm.org/doi/pdf/10.1145/3319535.3345653">https://dl.acm.org/doi/pdf/10.1145/3319535.3345653</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6962">[RFC6962]</dt>
        <dd>
<span class="refAuthor">Laurie, B.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">E. Kasper</span>, <span class="refTitle">"Certificate Transparency"</span>, <span class="seriesInfo">RFC 6962</span>, <span class="seriesInfo">DOI 10.17487/RFC6962</span>, <time datetime="2013-06" class="refDate">June 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6962">https://www.rfc-editor.org/rfc/rfc6962</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7633">[RFC7633]</dt>
        <dd>
<span class="refAuthor">Hallam-Baker, P.</span>, <span class="refTitle">"X.509v3 Transport Layer Security (TLS) Feature Extension"</span>, <span class="seriesInfo">RFC 7633</span>, <span class="seriesInfo">DOI 10.17487/RFC7633</span>, <time datetime="2015-10" class="refDate">October 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7633">https://www.rfc-editor.org/rfc/rfc7633</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9458">[RFC9458]</dt>
      <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious HTTP"</span>, <span class="seriesInfo">RFC 9458</span>, <span class="seriesInfo">DOI 10.17487/RFC9458</span>, <time datetime="2024-01" class="refDate">January 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9458">https://www.rfc-editor.org/rfc/rfc9458</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">TODO acknowledge.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Brendan McMillion</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:brendanmcmillion@gmail.com" class="email">brendanmcmillion@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
